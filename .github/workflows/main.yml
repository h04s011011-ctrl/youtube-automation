name: Nature Canvas Factory
on:
  repository_dispatch:
    types: [start-build]
  workflow_dispatch:

jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Download and Process
        run: |
          echo "ğŸ“½ï¸ æ˜ åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­..."
          curl -L "${{ github.event.client_payload.v_url }}" -o base_video.mp4
          
          echo "ğŸµ éŸ³å£°ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­..."
          curl -L "${{ github.event.client_payload.a_url }}" -o base_audio.mp3
          
          echo "ğŸ§ª ãƒ•ã‚¡ã‚¤ãƒ«ã®çŠ¶æ…‹ã‚’ç¢ºèª..."
          ls -lh base_video.mp4 base_audio.mp3
          
          echo "ğŸ¬ å‹•ç”»åˆæˆã‚’é–‹å§‹..."
          # ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚„ã™ã„éƒ¨åˆ†ã‚’å¼·åŒ–ã—ãŸã‚³ãƒãƒ³ãƒ‰
          ffmpeg -i base_video.mp4 -i base_audio.mp3 -c:v libx264 -preset fast -crf 23 -c:a aac -b:a 128k -map 0:v:0 -map 1:a:0 -shortest -y final_video.mp4

      - name: Upload Result
        if: success()
        uses: upload-artifact@v4
        with:
          name: Nature-Canvas-Final
          path: final_video.mp4
