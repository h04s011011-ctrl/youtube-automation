name: Auto Video Render
on:
  repository_dispatch:
    types: [start-build]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Install FFmpeg
        run: sudo apt install -y ffmpeg

      - name: Render Video
        run: |
          # iPhoneから届いたURLで素材をダウンロード
          curl -L "${{ github.event.client_payload.sound_url }}" -o sound.mp3
          # サンプル画像を1枚用意（本来はPixabay URLを使います）
          curl -L "https://images.pexels.com/photos/249614/pexels-photo-249614.jpeg" -o image.jpg
          
          # FFmpegで1分のテスト動画を作成（8時間はここで数値を調整）
          ffmpeg -loop 1 -i image.jpg -i sound.mp3 -c:v libx264 -t 60 -pix_fmt yuv420p -vf "scale=1280:720" output.mp4

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: finished-video
          path: output.mp4
